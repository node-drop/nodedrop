<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget Demo - Manual Initialize</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .demo-section p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn.danger {
            background: #dc3545;
        }

        .btn.danger:hover {
            background: #c82333;
        }

        .btn.success {
            background: #28a745;
        }

        .btn.success:hover {
            background: #218838;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .status.ready {
            background: #d4edda;
            color: #155724;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            border-radius: 4px;
        }

        .log-entry.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-entry.success {
            background: #d4edda;
            color: #155724;
        }

        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üõ†Ô∏è Manual Chat Widget Demo</h1>
            <p>Full control over chat widget initialization with JavaScript API and custom callbacks.</p>
        </div>

        <div class="demo-section">
            <h2>Manual Initialization <span id="status" class="status loading">Loading</span></h2>
            <p>This demo shows how to manually initialize the chat widget with full control over its behavior.</p>
            
            <div class="controls">
                <button id="initBtn" class="btn" onclick="initializeChat()">Initialize Chat</button>
                <button id="openBtn" class="btn" onclick="openChat()" disabled>Open Chat</button>
                <button id="closeBtn" class="btn" onclick="closeChat()" disabled>Close Chat</button>
                <button id="destroyBtn" class="btn danger" onclick="destroyChat()" disabled>Destroy Chat</button>
                <button id="sendBtn" class="btn success" onclick="sendTestMessage()" disabled>Send Test Message</button>
            </div>

            <div class="code-block">
&lt;!-- Load widget script --&gt;
&lt;script src="http://localhost:3000/widgets/chat/nd-chat-widget.umd.js"&gt;&lt;/script&gt;

&lt;!-- Initialize with JavaScript --&gt;
&lt;script&gt;
  const widget = new window.nodeDropChatWidget();
  
  widget.init({
    chatId: 'ca37729d-50bd-4d4d-bb3b-fa8d61e3bdd5',
    apiUrl: 'http://localhost:4000/api',
    theme: 'light',
    position: 'bottom-right',
    onMessage: (message) =&gt; {
      console.log('User sent:', message);
    },
    onResponse: (response) =&gt; {
      console.log('AI responded:', response);
    },
    onError: (error) =&gt; {
      console.error('Chat error:', error);
    }
  });
&lt;/script&gt;
            </div>

            <h3>Event Log</h3>
            <div id="log" class="log">
                <div class="log-entry info">Page loaded - Ready to initialize chat widget</div>
            </div>
        </div>
    </div>

    <!-- Load widget script -->
    <script src="http://localhost:3000/widgets/chat/nd-chat-widget.umd.js"></script>

    <script>
        let widget = null;
        let isInitialized = false;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(status, text) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${status}`;
            statusEl.textContent = text;
        }

        function updateButtons() {
            document.getElementById('initBtn').disabled = isInitialized;
            document.getElementById('openBtn').disabled = !isInitialized;
            document.getElementById('closeBtn').disabled = !isInitialized;
            document.getElementById('destroyBtn').disabled = !isInitialized;
            document.getElementById('sendBtn').disabled = !isInitialized;
        }

        function initializeChat() {
            try {
                log('Initializing chat widget...', 'info');
                updateStatus('loading', 'Initializing');

                // Check if nodeDropChatWidget is available
                if (typeof window.nodeDropChatWidget === 'undefined') {
                    throw new Error('nodeDropChatWidget not found. Make sure the script is loaded.');
                }

                widget = new window.nodeDropChatWidget();
                
                widget.init({
                    chatId: 'ca37729d-50bd-4d4d-bb3b-fa8d61e3bdd5',
                    apiUrl: 'http://localhost:4000/api',
                    theme: 'light',
                    position: 'bottom-right',
                    onMessage: (message) => {
                        log(`User message: ${message}`, 'info');
                    },
                    onResponse: (response) => {
                        log(`AI response: ${response}`, 'success');
                    },
                    onError: (error) => {
                        log(`Error: ${error}`, 'error');
                    },
                    onOpen: () => {
                        log('Chat opened', 'success');
                    },
                    onClose: () => {
                        log('Chat closed', 'info');
                    }
                });

                isInitialized = true;
                updateStatus('ready', 'Ready');
                updateButtons();
                log('Chat widget initialized successfully!', 'success');

            } catch (error) {
                log(`Initialization failed: ${error.message}`, 'error');
                updateStatus('error', 'Error');
                console.error('Chat initialization error:', error);
            }
        }

        function openChat() {
            if (widget && widget.open) {
                widget.open();
                log('Opening chat...', 'info');
            } else {
                log('Widget not initialized or open method not available', 'error');
            }
        }

        function closeChat() {
            if (widget && widget.close) {
                widget.close();
                log('Closing chat...', 'info');
            } else {
                log('Widget not initialized or close method not available', 'error');
            }
        }

        function destroyChat() {
            if (widget && widget.destroy) {
                widget.destroy();
                widget = null;
                isInitialized = false;
                updateStatus('loading', 'Destroyed');
                updateButtons();
                log('Chat widget destroyed', 'info');
            } else {
                log('Widget not initialized or destroy method not available', 'error');
            }
        }

        function sendTestMessage() {
            if (widget && widget.sendMessage) {
                const testMessage = 'Hello! This is a test message from the demo.';
                widget.sendMessage(testMessage);
                log(`Sending test message: ${testMessage}`, 'info');
            } else {
                log('Widget not initialized or sendMessage method not available', 'error');
            }
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            log('Page loaded - Click "Initialize Chat" to start', 'info');
            updateButtons();
        });

        // Handle script loading errors
        window.addEventListener('error', function(event) {
            if (event.filename && event.filename.includes('nd-chat-widget')) {
                log('Failed to load chat widget script', 'error');
                updateStatus('error', 'Script Load Error');
            }
        });
    </script>
</body>
</html>